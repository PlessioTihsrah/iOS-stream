<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
  </head>
  <body>
    <canvas id="canvas" height="1920" width="1080"></canvas>
  </body>
  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const socket = io();
    const maxHeight = 700;
    canvas.height = maxHeight;
    let originalHeight = 0;
    let originalWidth = 0;

    canvas.addEventListener('click', ({x,y}) => {
      console.log(`Clicked at ${x},${y}`);
      const convertedX = (originalWidth / canvas.width) * x;
      const convertedY = (originalHeight / canvas.height) * y;

      console.log(`Clicked at converted ${convertedX},${convertedY}`);
      socket.emit("click", {x: convertedX, y: convertedY});
    })
    socket.on("connect", () => {
      console.log(socket.id); // x8WIv7-mJelg7on_ALbx
    });

    socket.on("screenshot", (data) => {
      const image = new Image();
      
      image.onload = function () {
        const newWidth = Math.floor((maxHeight / image.height) * image.width);
        originalHeight = image.height;
        originalWidth = image.width;
        if(canvas.width !== newWidth) {
          console.log("Changing width")
          canvas.width = newWidth;
        }
        ctx.drawImage(image, 0, 0, newWidth, maxHeight);
        
      };
      image.src = "data:image/png;base64," + data;
    });

    socket.on("disconnect", () => {
      console.log(socket.id); // undefined
    });
  </script>
</html>
